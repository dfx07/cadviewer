<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:CadViewer.UIControls"
                    xmlns:cvt="clr-namespace:CadViewer.Converters"
                    xmlns:sys="clr-namespace:System;assembly=mscorlib">
    <cvt:CommonColorKeyToColorConverter x:Key="ColorKeyToColorConverter" />
    <cvt:ToggleButtonHeightToThumbWidthConverter x:Key="HeightToThumbWidthConverter" />
    <cvt:ToggleButtonCheckNSelectColorConverter x:Key="ToggleButtonCheckNSelectColorConverter" />
    <cvt:CommonSetDoubleDefaultConverter x:Key="SetDoubleDefaultConverter" />

    <Style TargetType="{x:Type local:CDropDownButton}" BasedOn="{StaticResource {x:Type ToggleButton}}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:CDropDownButton}">
                    <Border x:Name="PART_BoundBorder" BorderThickness="1" Height="{TemplateBinding Height}"
                            CornerRadius="{DynamicResource CompUI_Cmm_CornerRadius}" SnapsToDevicePixels="True" ClipToBounds="True">
                        <Border.Background>
                            <SolidColorBrush Color="{DynamicResource CompUI_Cmm_BackgroundColor}" />
                        </Border.Background>
                        <Border.BorderBrush>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                <LinearGradientBrush.GradientStops>
                                    <GradientStop Color="{DynamicResource CompUI_DropDown_BorderColor}" Offset="0.0" />
                                    <GradientStop Color="{DynamicResource CompUI_DropDown_BorderColor}" Offset="0.9" />
                                    <GradientStop Color="{DynamicResource CompUI_DropDown_BorderEndColor}" Offset="1.0" />
                                </LinearGradientBrush.GradientStops>
                            </LinearGradientBrush>
                        </Border.BorderBrush>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <ToggleButton x:Name="PART_DropDownButton" Grid.Column="0" Width="20" IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                                        <Border x:Name="PART_DropDownButton_Bound" CornerRadius="2,0,0,2" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" BorderThickness="0,0,1,0">
                                            <Border.Background>
                                                <SolidColorBrush Color="Transparent" />
                                            </Border.Background>
                                            <Border.BorderBrush>
                                                <SolidColorBrush Color="{DynamicResource CompUI_DropDown_BorderColor}" />
                                            </Border.BorderBrush>
                                            <Path x:Name="PART_DropDownButton_Path" Data="M 0 0 L 4 4 L 8 0" Stroke="Gray" Margin="5" StrokeThickness="2" HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5" Stretch="Uniform" SnapsToDevicePixels="True">
                                                <Path.RenderTransform>
                                                    <RotateTransform x:Name="xComboBoxDropdownPathRotate" Angle="0" />
                                                </Path.RenderTransform>
                                            </Path>
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualState x:Name="_Normal">
                                                        <Storyboard>
                                                            <ColorAnimation Storyboard.TargetName="PART_DropDownButton_Bound"
                                                                            Storyboard.TargetProperty="(Background).Color"
                                                                            To="Transparent"
                                                                            Duration="0:0:0.1" />
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="_NormalChecked">
                                                        <Storyboard>
                                                            <ColorAnimation Storyboard.TargetName="PART_DropDownButton_Bound" 
                                                                            Storyboard.TargetProperty="(Background).Color"
                                                                            To="{DynamicResource CompUI_DropDown_ButtonBackgroundCheckedColor}"
                                                                            Duration="0:0:0.1" />
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="MouseOver">
                                                        <Storyboard>
                                                            <ColorAnimation Storyboard.TargetName="PART_DropDownButton_Bound" 
                                                                            Storyboard.TargetProperty="(Background).Color"
                                                                            To="{DynamicResource CompUI_DropDown_ButtonBackgroundOverColor}"
                                                                            Duration="0:0:0.1" />
                                                        </Storyboard>
                                                    </VisualState>
                                                </VisualStateGroup>
                                                <VisualStateGroup x:Name="CheckStatus">
                                                    <VisualState x:Name="Unchecked">
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="xComboBoxDropdownPathRotate" 
                                                                             Storyboard.TargetProperty="Angle" From="180" To="0"
                                                                             Duration="0:0:0.2" AccelerationRatio="0.3" DecelerationRatio="0.3" />
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Checked">
                                                        <Storyboard>
                                                            <ColorAnimation Storyboard.TargetName="PART_DropDownButton_Bound" 
                                                                             Storyboard.TargetProperty="(Background).Color" 
                                                                             To="{DynamicResource CompUI_DropDown_ButtonBackgroundCheckedColor}" 
                                                                             Duration="0:0:0.0"/>
                                                            <DoubleAnimation Storyboard.TargetName="xComboBoxDropdownPathRotate" 
                                                                             Storyboard.TargetProperty="Angle" From="0" To="180" 
                                                                             Duration="0:0:0.2" AccelerationRatio="0.3" DecelerationRatio="0.3" />
                                                        </Storyboard>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateManager.VisualStateGroups>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <Border x:Name="PART_Content_Bound" Grid.Column="1" Background="Transparent">
                                <ContentPresenter x:Name="PART_Content" Margin ="2"
                                                  ContentTemplate="{TemplateBinding ContentTemplate}"
                                                  ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                            </Border>

                            <local:CFlexPopup x:Name="PART_Popup" Focusable="True" HorizontalAlignment="Left" HorizontalOffset="-6" Placement="Bottom"
                                   AllowsTransparency="True" PlacementTarget="{Binding ElementName=PART_DropDownButton_Bound}" OpenMode="AutoClose"
                                   IsOpen="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" Height="100">
                                <ContentPresenter Content="{TemplateBinding DropDownContent}" />
                            </local:CFlexPopup>
                        </Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal">
                                    <Storyboard>
                                        <ColorAnimation Storyboard.TargetName="PART_BoundBorder" 
                                                        Storyboard.TargetProperty="(Background).Color" 
                                                        To="{DynamicResource CompUI_Cmm_BackgroundColor}" Duration="0:0:0.1" />
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="AllMouseOver">
                                    <Storyboard>
                                        <ColorAnimation Storyboard.TargetName="PART_BoundBorder" 
                                                        Storyboard.TargetProperty="(Background).Color"
                                                        To="{DynamicResource CompUI_DropDown_ButtonBackgroundOverColor}" Duration="0:0:0.1" />
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="AllPressed">
                                    <Storyboard>
                                        <ColorAnimation Storyboard.TargetName="PART_BoundBorder" 
                                                        Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)"
                                                        To="{DynamicResource CompUI_DropDown_BackgroundClickColor}" Duration="0:0:0.1" />
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                    </Border>
                    <ControlTemplate.Triggers>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>